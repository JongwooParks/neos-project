<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>NEOS | 유저 관리</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="robots" content="noindex">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/bootstrap.css?1630317764">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/jquery-ui.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/ii.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/db-icons.css?1577682282"> <!-- 아이콘 필수 -->
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/material-design-iconic-font.min.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/bootstrap-datepicker.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/black-tie.css?1608189400">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/simple-line-icons.css?1608179394">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/fonts/im-icon/style.css?1656383913">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/fonts/froala-emoji-tap/style.css?1660095148">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/preloader.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/owl.carousel2.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/slick.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/animate.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/nprogress.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/trackpad-scroll-emulator.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/font-awesome.min.css?1626931454">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/font-awesome5.min.css?1660780829">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/froala_311/css/froala_editor.pkgd.css?1660095140">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/froala_311/css/froala_style.min.css?1660095060">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/emoji.css?1660095097">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/froala/custom-theme-v3.css?1663833898">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/colorpicker.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/codemirror.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/bootstrap-spinner.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/chosen.css?1617331870">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/fullcalendar.min.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/morris.core.css?1577682282">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/lightgallery.min.css?1596596378">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/im_component.css?1636689958">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/site/admin/admin.css?1590627710">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/site/admin/toastr.css?1593569516">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/site/alarm_menu.css?1648796493">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/fonts/fontello/src/css/fontello.css?1657576838">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/site/admin/bootstrap-theme-dashboard.css?1618365623">
<!--    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/site/admin/dashboard.css?1663833898">-->
    <link rel="stylesheet" href="/css/admin/configBannerDash.css">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/site/admin/select2.css?1590627710">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/site/admin/accordion.css?1653367465">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/regularly.css?1658818153">
    <link rel="stylesheet" type="text/css" href="https://vendor-cdn.imweb.me/css/tailwind.css?1664422527">
    <script src="https://vendor-cdn.imweb.me/js/jquery.js?1627517460"></script>
    <script src="https://vendor-cdn.imweb.me/js/jquery.browser.js?1577682292"></script>
    <script src="https://vendor-cdn.imweb.me/js/jquery-ui.min.js?1577682292"></script>
    <script src="https://vendor-cdn.imweb.me/js/bootstrap.min.js?1630317768"></script>
    <script src="https://vendor-cdn.imweb.me/js/floating-ui-core@1.0.1.js?1662343131"></script>
    <script src="https://vendor-cdn.imweb.me/js/floating-ui-dom@1.0.1.js?1662343131"></script>
    <script src="https://vendor-cdn.imweb.me/js/tinycolor-min.js?1577682292"></script>
    <script src="https://vendor-cdn.imweb.me/js/common.js?1661221108"></script>
    <script src="https://vendor-cdn.imweb.me/js/table_list.js?1633057104"></script>
    <link rel="icon" type="image/x-icon" href="/images/fix/favicon.png">
    <link rel="stylesheet" href="/css/admin/userList.css">
    <link rel="stylesheet" href="/css/admin/adminTotalCss.css">
    <link rel="stylesheet" href="/css/admin/adminPaging.css">
    <link rel="stylesheet" href="/css/admin/modal.css">
    <style>
        .badge {
            display: inline-block;
            min-width: 10px;
            padding: 3px 7px;
            font-weight: bold;
            line-height: 1;
            color: #fff;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            background-color: #777777;
            border-radius: 10px;
            padding-top: 5px;
        }
    </style>
</head>

<body class="menubar-hoverable header-fixed menubar-pin menubar-visible">
<!-- START BASE -->
<div id="base">
    <!-- START HEADER -->
    <header class="top_header" id="default_header">
        <div class="headerbar">
            <div class="headerbar-left">
                <ul class="header-nav header-nav-options">
                    <li class="hidden-lg hidden-md">
                        <a class="btn btn-icon-toggle menubar-toggle" data-toggle="menubar" href="javascript:void(0);">
                            <i class="btl bt-bars"></i>
                        </a>
                    </li>
                    <li class="header-nav-brand">
                        <div class="brand-holder">
								<span class="location_text">
									<a href="#">사용자 목록</a>	<!-- 동일 페이지로 재이동 -->
								</span>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </header> <!-- END HEADER -->
    <!-- START MENUBAR HEADER -->
    <div th:replace="/app/admin/adminNavBar.html :: adminMenuBarHeader"></div>
    <!-- END MENUBAR HEADER -->
    <!-- BEGIN MENUBAR-->
    <div th:replace="/app/admin/adminNavBar.html ::  adminMenu"></div>
    <!--END MENUBAR&ndash;&gt;-->
    <div class="modalWrapOpen">
        <div class="commonModal">
            <p class="modalTit" style="font-size: 18px;margin-bottom: 15px">유저 삭제 확인</p><button class="closeBtn"><img
                src="/images/admin/closeBtn.png" alt="close"></button>
            <div class="commonModalContent">
                <p style="font-size: 12px;margin-bottom: 12px;">해당 유저를 삭제하시겠습니까?</p>
            </div>
            <div class="btnWrap doubleBtnWrap"><button class="btn whiteBtn" style="font-size: 12px;line-height: 3;">아니오</button><button
                    class="btn redBtn deleteOk" id="deleteCheck" style="font-size: 12px;line-height: 3;">예</button></div>
        </div>
    </div>

    <div class="modalWrapOpen2">
        <div class="commonModal2">
            <p class="modalTit2" style="font-size: 18px;margin-bottom: 15px">유저 삭제 확인</p><button class="closeBtn2"><img
                src="/images/admin/closeBtn.png" alt="close"></button>
            <div class="commonModalContent2">
                <p style="font-size: 12px;margin-bottom: 12px;">한명 이상의 유저를 체크해야 합니다.</p>
            </div>

        </div>
    </div>

    <!-- START MAIN CONTENT -->

    <div id="content">
        <div id="alertBox" class="alert__wrap"></div>
        <section class="content">
            <div class="section-body">
                <div class="tab-pane" id="daily">
                    <div class="row">
                        <div class="col-md-9 col-xl-10">
                            <div class="row">
                                <div class="col-md-10"> <!-- START 검색창 -->
                                    <div class="card">
                                        <div class="card-body no-padding">
                                            <div class="user-search" id="userSearch">
                                            </div>
                                        </div>
                                    </div>
                                </div> <!-- END 검색창 -->
                                <div class="col-md-2 hidden-xs">
                                    <div class="card">
                                        <div class="memberDelete">
                                            <a href="#" >선택 사용자 삭제</a>
                                            <span>
													<!-- <button type="button" class="button" style="display:none";></button> -->
												</span>
                                        </div>
                                    </div>
                                </div>



                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-head" id="card-head">
                                            <header class="small">전체 사용자
                                                <span class="text-primary" id="total-member-count" th:text="${total}"></span>명
                                            </header>

                                        </div>

                                        <div class="card-body no-padding">
                                            <div class="li_table" id="UI_TABLE">
                                                <ul class="subject _thead" id="table-header" >
                                                    <li class="check">
                                                        <div class="checkbox checkbox-styled no-margin">
                                                            <label>
                                                                <input type="checkbox" value="" class="_all_check term" name="term"><span></span>
                                                            </label>
                                                        </div>
                                                    </li>
                                                    <li class="nick"><a href="#">닉네임</a></li>
                                                    <li class="account">계정</li>
                                                    <li class="dateJoin">가입일</li>
                                                    <li class="participationProject">자료 상점</li>
                                                    <li class="participationStudy">스터디</li>
                                                    <li class="countPost">게시글</li>
                                                    <li class="countComment">댓글</li>
                                                    <li class="countQuestion">문의</li>
                                                    <li class="action"></li>
                                                </ul>

                                                <tbody>
                                                <th:block th:each="user:${users}" th:object="${user}">
                                                <ul class="content _tbody" id="member_item_m20220929a41c742d48942" data-nick="관리자" data-app="">
                                                    <input type="hidden" th:href="*{userId}" class="userId">
                                                    <li class="check"> <!-- CHECKBOX -->
                                                        <div class="checkbox checkbox-styled no-margin">
                                                            <label>
                                                                <input type="checkbox" class="terms">
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </li>

                                                    <li class="nick userInfo">
                                                        <a href="#" class="userNickName" th:text="*{userNickName}"></a>
                                                        <input type="hidden" th:href="*{userId}" class="userId">
                                                    </li>
                                                    <li class="account" th:text="*{userOAuthEmail}"></li>
                                                    <li class="dateJoin" th:text="*{#temporals.format(createdDate, 'yyyy.MM.dd HH:mm')}"></li>

                                                    <th:block th:each="counts:${user.counts}">
                                                        <li class="participationProject" th:text="${counts.storeCount}"></li>
                                                        <li class="participationStudy" th:text="${counts.studyCount}"></li>
                                                        <li class="countPost">
                                                            <a href="#" onclick="" th:text="${counts.communityCount+counts.counselingCount}"></a> <!-- 마이페이지 내 게시글로 이동 -->
                                                        </li>
                                                        <li class="countComment" th:text="${counts.replyCount}"></li>
                                                        <li class="countQuestion" th:text="${counts.inquiryCount}">0</li>
                                                    </th:block>


                                                    <li class="action">
                                                        <div class="dropdown">
                                                            <button id="dLabel" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn btn-flat">
                                                                <i class="zmdi zmdi-more"></i>
                                                            </button>
                                                            <ul class="dropdown-menu animation-dock right" role="menu" aria-labelledby="dLabel">
                                                                <li>
                                                                    <a href="javascript:;" class="deleteBtn"

                                                                    >
                                                                        삭제
                                                                    </a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </li>
                                                </ul>
                                                </th:block>
                                                </tbody>

                                            </div>
                                            <nav class="text-center" id="paginate"></nav>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section>
            <div class="pagingAndBtn" >
                <span class="pagination pagination-sm clearfix">
                    <input type="hidden" id="nowPage" th:value="${nowPage}">
                    <input type="hidden" id="total" th:value="${total}">
                    <input type="hidden" id="size" th:value="${size}">
                    <input type="hidden" id="endPage" th:value="${endPage}">

                    <!--                    <input type="hidden" id="startPage" th:value="${startPage}">-->
                    <th:block th:with="start=${T(java.lang.Math).floor(users.number/5)*5+1},
                               last=(${start + 4 < users.totalPages ? start + 4 : users.totalPages})" th:if="${total != 0}">
                        <th:block th:if="${start!=1}">
                            <a class="btn_paging prev screen_out paging"
                               th:href="${users.first} ? '#' :@{/admin/user/list(page=${users.number-1})}"></a>
                        </th:block>
                        <th:block th:unless="${start!=1}">
                            <a class="btn_paging prev screen_out paging" style="display: none"
                               th:href="${users.first} ? '#' :@{/admin/user/list(page=${users.number-1})}"></a>
                        </th:block>
                        <th:block th:each="num : ${#numbers.sequence(start, last)}">
                            <a class="paging" th:text="${num}" th:href="@{/admin/user/list(page=${num-1})}"></a>
                        </th:block>
                        <th:block th:if="${last != endPage}">
                            <a class="btn_paging next screen_out paging"
                               th:href="${users.last} ? '#' : @{/admin/user/list(page=${users.number+1})}"></a>
                        </th:block>
                        <th:block th:unless="${last != endPage}">
                            <a class="btn_paging next screen_out paging" style="display: none"
                               th:href="${users.last} ? '#' : @{/admin/user/list(page=${users.number+1})}"></a>
                        </th:block>
                    </th:block>
                </span>
            </div>
        </section>

    </div><!--end #content-->

    <!-- END MAIN CONTENT -->
</div> <!-- END BASE -->
</body>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
<script>

    // base.html

    // 문서로드 완료 후 자바 스크립트 진행
    document.addEventListener('DOMContentLoaded', function() {
        const alertBox = document.querySelector('#alertBox');
        const contentArea = document.querySelector('#content');

        alertBox.classList.remove('alert__wrap-fixed');
        alertBox.classList.add('alert__wrap');
        contentArea.prepend(alertBox);
    });


    // 좌측 슬라이드 배너 작동
    $('.gui-folder').click(function(){
        $(this).toggleClass('expanded'); /* expanded가 없으면 생성, 있으면 삭제, 따라서 gui-folder은 계속 유지 */
        $(this).parent().children('.expanded').not(this).removeClass('expanded');
    });


    // 체크박스
    const $all = $(".term");
    const $terms = $(".terms");

    console.log($all)
    console.log($terms)

    // 전체 체크박스 선택
    $all.on("click", function(){
        $terms.prop("checked", $(this).is(":checked"));
    });

    // 각각의 체크박스 선택
    $terms.on("click", function(){
        $all.prop("checked", $terms.filter(":checked").length == $terms.length);

    });

    // 모달 관련
    const $deleteModal = $(".modalWrapOpen");
    const $alertModal = $(".modalWrapOpen2")
    const $deleteBtn = $(".memberDelete a");
    const $cancelBtn = $(".whiteBtn");
    const $closeBtn = $(".closeBtn")
    const $closeBtn2 = $(".closeBtn2")
    $deleteBtn.click(function () {
        if($terms.filter(":checked").length==0){
            $alertModal.show();
            return;
        }
        $deleteModal.show();
    })

    $cancelBtn.click(function () {
        $deleteModal.hide();
    })

    $closeBtn.click(function () {
        $deleteModal.hide();
    })
    $closeBtn2.click(function () {
        $alertModal.hide();
    })

    function modalUp(){
        $deleteModal.show();
    }

    // 현재 페이지 css
    pageActive();

    function pageActive() {
        let $nowPage = $('#nowPage').attr('value');
        let $endPage = $('#endPage').attr('value');

        $('a.paging').each(function(){
            if(($(this).text()-1) == $nowPage){
                $(this).addClass('active');
            }
        });
    }

    // 유저 상세보기로 이동
    $('.userNickName').click(function () {
        var userId = $(this).next().attr('href');
        location.href = "/admin/user/detail" + "?userId=" + userId;
    })

    // 체크된 리스트 삭제
    $('#deleteCheck').click(function() {
        var userIds = "";
        $(".terms:checked").each(function() {
            if(userIds == ""){
                userIds = $(this).closest(".check").next().find(".userId").attr("href");
            } else {
                userIds = userIds + "," + $(this).closest(".check").next().find(".userId").attr("href");
            }
        });
        location.href = "/admin/user/deleteCheck" + "?userIds=" + userIds;
    });

    // 하나만 삭제
    $('.deleteBtn').click(function () {
        let userId = $(this).closest('.action').prev().parent().find(".userInfo").find('.userId').attr('href');
        modalUp();
        $('#deleteCheck').click(function () {
            location.href = "/admin/user/delete" + "?userId=" + userId;
        })
    })

</script>
</html>